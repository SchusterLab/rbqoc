\section{QOC on the Fluxonium \label{sec:fluxonium}}
In the following, we study
the QOC problem on the fluxonium qubit.
The fluxonium qubit is a promising building block for superconducting
circuits, and the accurate
two-level approximation of its Hamiltonian makes
QOC on a classical computer inexpensive.
In the two-level
approximation the Hamiltonian takes the form:
\begin{align}
  H/h &= f_{q} \frac{\sigma_{z}}{2} + a(t) \frac{\sigma_{x}}{2}
  \label{eq:hamiltonian}
\end{align}
where $f_{q} = 14$MHz is the qubit frequency at the flux frustration point,
$a(t)$ is the flux drive amplitude, $h$ is Planck's constant, and $\sigma_{x}, \sigma_{y}$
are Pauli matrices. We consider the task of constructing $Z/2$, $Y/2$, and $X/2$
gates for the fluxonium qubit subject to experimental constraints, decoherence, and
Hamiltonian parameter deviations. We compare the gates we obtain with numerical
methods to the analytically constructed gates reported in
\cite{zhang2020universal} for the same device.

The optimization problem takes the form:
\begin{mini!}[2] 
  {x_{1:N}, u_{1:N\text{-}1}}{\sum_{k=1}^N \norm{x_k\text{-}x_f}_{Q_k}
    + \sum_{k=1}^{N-1} \norm{u_k}_{R_k}}{}{} \label{eq:costfun}
  \addConstraint{x_{k+1}}{= f(x_k, u_k)}  \label{eq:dyn_con}
  \addConstraint{\ket{\psi^{0}_{1}} = \ket{0}, \ket{\psi^{1}_{1}} = \ket{1}} \label{eq:istate_con}
  \addConstraint{\ket{\psi^{i}_{N}} = \ket{\psi^{i}_{f}}} \label{eq:tstate_con}
  \addConstraint{{\lvert \braket{\psi^{i}_{k}}{\psi^{i}_{k}}
      \rvert}^{2} = 1} \label{eq:statenorm_con}
  \addConstraint{{\textstyle \int^{t_{1}}_{0} a \ \mathrm{d}t} = \pdv*{a_{1}}{t} = 0}
  \label{eq:icintd_con}
  \addConstraint{{\textstyle \int^{t_{N}}_{0}} a \ \mathrm{d}t= 0} \label{eq:znf_con}
  \addConstraint{a_{1} = a_{N} = 0} \label{eq:concat_con}
  \addConstraint{|a_{k}| \leq 0.5 \ \textrm{GHz}} \label{eq:amp_con}
\end{mini!}
The augmented state and augmented controls are:
\begin{equation}
  x = \begin{bmatrix} \psi^{0} \\ \psi^{1} \\ \int^{t}_{0} a \ \mathrm{d}t\\ a \\ \pdv*{a}{t} \end{bmatrix} \quad
  u = \begin{bmatrix} \pdv*[2]{a}{t} \end{bmatrix}
  \label{eq:astatecontrols}
\end{equation}
The matrices $Q_{k}$ and $R_{k}$ define the penalty metric.
Including objectives at each knot point smoothens the optimization landscape, though
the importance of the final objective is encoded in the relative
weight $Q_{N} \sim N \cdot Q_{k}$.
We choose $Q$ to be diagonal because it is computationally efficient. This
metric penalizes phase differences between the states, although
phase-insensitive metrics such as infidelity may be employed.

\todo{Ask Brian to review this paragraph and the constraints \eqref{eq:dyn_con}-\eqref{eq:amp_con}.
  Is it okay if I have multiple constraints on the same line? The constraints that are on the same
  line are imposed for similar reasons, which makes the list shorter and it easier to reference them here.}
We impose constraints that
reflect the physical limitations of the apparatus and 
improve the experimental realization of the control pulse.
The discrete dynamics \eqref{eq:dyn_con} integrates the states
according to the TDSE \eqref{eq:tdse} and the
fluxonium Hamiltonian \eqref{eq:hamiltonian}
and integrates the moments of the flux amplitude.
Exposing lower order moments of the flux amplitude allows us to penalize their norms
in \eqref{eq:costfun}, smoothing the flux amplitude
and mitigating AWG ringing due to high frequency transitions.
We ensure the desired gate is achieved by imposing the constraints
\eqref{eq:istate_con} and \eqref{eq:tstate_con}.
The initial states in \eqref{eq:istate_con}
are chosen to span the Hilbert space.
The final states in \eqref{eq:tstate_con} are the image
of the initial states under the desired gate.
The ALTRO implementation we use does not currently support complex numbers so
we compute in the isomorphism $\mathcal{H}(\mathbb{C}^{n}) \cong \mathcal{H}(\mathbb{R}^{2n})$
given in \cite{leung2017speedup},
\begin{equation}
  H \ket{\psi} \cong \begin{bmatrix} H_{\textrm{re}} & -H_{\textrm{im}}
    \\ H_{\textrm{im}} & H_{\textrm{re}}\end{bmatrix}
  \begin{bmatrix} \psi_{\textrm{re}} \\ \psi_{\textrm{im}}\end{bmatrix}
  \label{eq:isomorphism}
\end{equation}
We ensure the solver does not take advantage of discretization
error by imposing the normalization constraint \eqref{eq:statenorm_con}.
The constraint \eqref{eq:icintd_con} is an initial condition.
We ensure the pulse has zero net flux by imposing \eqref{eq:znf_con},
which mitigates the hysteresis ubiquitous in flux bias lines
\cite{battistel2019fast, krantz2019quantum, zhang2020universal}.
We ensure gates may be concatenated arbitrarily without
inducing AWG ringing due to high-frequency transitions by imposing
the boundary condition \eqref{eq:concat_con}.
Finally, we ensure the two-level
approximation \eqref{eq:hamiltonian} remains valid
by imposing the amplitude constraint \eqref{eq:amp_con}.
All of the gates presented in this work achieve a maximum
individual constraint violation of $10^{-8}$
for \eqref{eq:dyn_con}--\eqref{eq:amp_con}.

